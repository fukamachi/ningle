<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>ningle by fukamachi</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <header>
        <h1>ningle</h1>
        <p>A lightweight web application framework for Common Lisp</p>
      </header>

      <div id="banner">
        <span id="logo"></span>

        <a href="https://github.com/fukamachi/ningle" class="button fork"><strong>Fork On GitHub</strong></a>
        <div class="downloads">
          <span>Downloads:</span>
          <ul>
            <li><a href="https://github.com/fukamachi/ningle/zipball/master" class="button">ZIP</a></li>
            <li><a href="https://github.com/fukamachi/ningle/tarball/master" class="button">TAR</a></li>
          </ul>
        </div>

      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
        <ul></ul>
      </nav>
      <section>
        <p>"ningle" is a lightweight web application framework for Common Lisp.</p>

<h2>Usage</h2>

<div class="highlight">
<pre><span class="p">(</span><span class="nb">defvar</span> <span class="vg">*app*</span> <span class="p">(</span><span class="nb">make-instance</span> <span class="ss">'ningle:&lt;app&gt;</span><span class="p">))</span>

<span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nv">ningle:route</span> <span class="vg">*app*</span> <span class="s">"/"</span><span class="p">)</span>
      <span class="s">"Welcome to ningle!"</span><span class="p">)</span>

<span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nv">ningle:route</span> <span class="vg">*app*</span> <span class="s">"/login"</span> <span class="ss">:method</span> <span class="ss">:POST</span><span class="p">)</span>
      <span class="nf">#'</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">params</span><span class="p">)</span>
          <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">authorize</span> <span class="p">(</span><span class="nb">getf</span> <span class="nv">params</span> <span class="ss">:|username|</span><span class="p">)</span>
                         <span class="p">(</span><span class="nb">getf</span> <span class="nv">params</span> <span class="ss">:|password|</span><span class="p">))</span>
            <span class="s">"Authorized!"</span>
            <span class="s">"Failed...Try again."</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">clack:clackup</span> <span class="vg">*app*</span><span class="p">)</span>
</pre>
</div>


<p>Now you can access to http://localhost:5000/ and then ningle should show you "Welcome to ningle!".</p>

<h2>Installation</h2>

<div class="highlight">
<pre><span class="p">(</span><span class="nv">ql:quickload</span> <span class="ss">:ningle</span><span class="p">)</span>
</pre>
</div>


<h2>Description</h2>

<p>ningle is a fork project of <a href="http://fukamachi.github.com/caveman/">Caveman</a>. ningle doesn't require you to generate a project skeleton.</p>

<p>As this is a thin framework, you need to have subtle knowledge about <a href="http://clacklisp.org">Clack</a>. It is a server interface ningle bases on.</p>

<h2>Getting started</h2>

<h3>Routing</h3>

<p>ningle has the <a href="http://www.sinatrarb.com/">Sinatra</a>-like routing system.</p>

<div class="highlight">
<pre><span class="c1">;; GET request (default)</span>
<span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nv">ningle:route</span> <span class="vg">*app*</span> <span class="s">"/"</span> <span class="ss">:method</span> <span class="ss">:GET</span><span class="p">)</span> <span class="o">...</span><span class="p">)</span>

<span class="c1">;; POST request</span>
<span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nv">ningle:route</span> <span class="vg">*app*</span> <span class="s">"/"</span> <span class="ss">:method</span> <span class="ss">:POST</span><span class="p">)</span> <span class="o">...</span><span class="p">)</span>

<span class="c1">;; PUT request</span>
<span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nv">ningle:route</span> <span class="vg">*app*</span> <span class="s">"/"</span> <span class="ss">:method</span> <span class="ss">:PUT</span><span class="p">)</span> <span class="o">...</span><span class="p">)</span>

<span class="c1">;; DELETE request</span>
<span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nv">ningle:route</span> <span class="vg">*app*</span> <span class="s">"/"</span> <span class="ss">:method</span> <span class="ss">:DELETE</span><span class="p">)</span> <span class="o">...</span><span class="p">)</span>

<span class="c1">;; OPTIONS request</span>
<span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nv">ningle:route</span> <span class="vg">*app*</span> <span class="s">"/"</span> <span class="ss">:method</span> <span class="ss">:OPTIONS</span><span class="p">)</span> <span class="o">...</span><span class="p">)</span>
</pre>
</div>


<p>Route pattern may contain "keyword" to put the value into the argument.</p>

<div class="highlight">
<pre><span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nv">ningle:route</span> <span class="vg">*app*</span> <span class="s">"/hello/:name"</span><span class="p">)</span>
      <span class="nf">#'</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">params</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">"Hello, ~A"</span> <span class="p">(</span><span class="nb">getf</span> <span class="nv">params</span> <span class="ss">:name</span><span class="p">))))</span>
</pre>
</div>


<p>The above controller will be invoked when you access to "/hello/Eitarow" or "/hello/Tomohiro", and then <code>(getf params :name)</code> will be "Eitarow" and "Tomohiro".</p>

<p>Route patterns may also contain "wildcard" parameters. They are accessible by <code>(getf params :splat)</code>.</p>

<div class="highlight">
<pre><span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nv">ningle:route</span> <span class="vg">*app*</span> <span class="s">"/say/*/to/*"</span><span class="p">)</span>
      <span class="nf">#'</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">params</span><span class="p">)</span>
          <span class="c1">; matches /say/hello/to/world</span>
          <span class="p">(</span><span class="nb">getf</span> <span class="nv">params</span> <span class="ss">:splat</span><span class="p">)</span> <span class="c1">;=&gt; ("hello" "world")</span>
          <span class="p">))</span>

<span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nv">ningle:route</span> <span class="vg">*app*</span> <span class="s">"/download/*.*"</span><span class="p">)</span>
      <span class="nf">#'</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">params</span><span class="p">)</span>
          <span class="c1">; matches /download/path/to/file.xml</span>
          <span class="p">(</span><span class="nb">getf</span> <span class="nv">params</span> <span class="ss">:splat</span><span class="p">)</span> <span class="c1">;=&gt; ("path/to/file" "xml")</span>
          <span class="p">))</span>
</pre>
</div>


<h3>Request &amp; Response</h3>

<p>ningle provides two special variables named <code>*request*</code> and <code>*response*</code>. They will be bound to an instance <a href="http://clacklisp.org/doc/clack.request.html">Clack.Request</a> and <a href="http://clacklisp.org/doc/clack.response.html">Clack.Response</a> for each request.</p>

<p>For example, by using them, you can change the response status code, Content-Type or something like that in each controllers.</p>

<h3>Context</h3>

<p>ningle provides an useful function named <code>context</code>. It is an accessor to an internal hash table.</p>

<div class="highlight">
<pre><span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nv">context</span> <span class="ss">:database</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">dbi:connect</span> <span class="ss">:mysql</span>
                   <span class="ss">:database-name</span> <span class="s">"test-db"</span>
                   <span class="ss">:username</span> <span class="s">"nobody"</span>
                   <span class="ss">:password</span> <span class="s">"nobody"</span><span class="p">))</span>

<span class="p">(</span><span class="nv">context</span> <span class="ss">:database</span><span class="p">)</span>
<span class="c1">;;=&gt; #&lt;DBD.MYSQL:&lt;DBD-MYSQL-CONNECTION&gt; #x3020013D1C6D&gt;</span>
</pre>
</div>


<h3>Using Session</h3>

<p>ningle doesn't provide Session system in the core, but recommends to use <a href="http://clacklisp.org/doc/clack.middleware.session.html">Clack.Middleware.Session</a> with <a href="http://clacklisp.org/doc/clack.builder.html">Clack.Builder</a>.</p>

<div class="highlight">
<pre><span class="p">(</span><span class="nb">import</span> <span class="ss">'clack.builder:builder</span>
        <span class="ss">'clack.middleware.session:&lt;clack-middleware-session&gt;</span><span class="p">)</span>

<span class="p">(</span><span class="nv">clack:clackup</span>
  <span class="p">(</span><span class="nv">builder</span>
    <span class="nv">&lt;clack-middleware-session&gt;</span>
    <span class="vg">*app*</span><span class="p">))</span>
</pre>
</div>


<p>Of course, you can use other Clack Middlewares with ningle.</p>

<h2>See Also</h2>

<ul>
<li><a href="http://clacklisp.org/">Clack</a></li>
</ul><h2>Author</h2>

<ul>
<li>Eitarow Fukamachi (e.arrows@gmail.com)</li>
</ul><h2>Copyright</h2>

<p>Copyright (c) 2012 Eitarow Fukamachi (e.arrows@gmail.com)</p>

<h2>License</h2>

<p>Licensed under the LLGPL License.</p>
      </section>
      <footer>
        <p>Project maintained by <a href="https://github.com/fukamachi">fukamachi</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
    
  </body>
</html>